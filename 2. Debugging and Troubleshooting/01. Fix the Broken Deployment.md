#### Task: Fix the Broken Deployment

A Deployment named `broken-app` is already running in the cluster, but its pods are stuck in a `CrashLoopBackOff` state.

1. Identify and fix the issue causing the pods to crash.
2. The Deployment should:
   - Use the image `nginx:1.21`.
   - Serve traffic on port `80`.

To check the state of the pods, run:  
```bash
kubectl get pods
```

To view the pod logs, run:  
```bash
kubectl logs <pod-name>
```

---

### Step-by-Step Debugging

1. **Check Pod Status**:
   Start by verifying the status of the pods:
   ```bash
   kubectl get pods
   ```
   Look for events like `ErrImagePull` or `ImagePullBackOff`.

2. **Describe the Pod**:
   Use `kubectl describe pod <pod-name>` to see detailed events and confirm whether it's failing to pull the image. Pay attention to messages like:
   - `Failed to pull image`.
   - `DNS resolution error`.

3. **Test Network Connectivity**:
   - Use a temporary pod to test connectivity to the Docker Hub (or wherever the image is hosted):
     ```bash
     kubectl run debug-pod --image=busybox --restart=Never -- sh
     ```
   - Inside the pod, try to ping the image repository or use `nslookup` to test DNS:
     ```bash
     ping hub.docker.com
     nslookup hub.docker.com
     ```

4. **Check Node-Level Configuration**:
   - The issue might also be at the node level. Check if the node is able to access the repository:
     ```bash
     ssh <node-ip>
     curl -I https://hub.docker.com
     ```

5. **Inspect Image URL**:
   - Ensure the image name (`nginx:1.21`) is correct. If it's a private registry, confirm the appropriate credentials (Secrets) are configured.

---

### Fixing Potential Issues
If you confirm the issue is networking-related, here are some fixes:
1. **DNS Issue**:
   - Ensure the cluster has correct DNS settings. You can test and restart the DNS service (`kube-dns` or `CoreDNS`).

2. **Network Policies**:
   - If you're using Network Policies, ensure there are no rules blocking egress to external registries.

3. **Proxy Settings**:
   - If the node uses a proxy, ensure the proxy allows traffic to the image repository.
